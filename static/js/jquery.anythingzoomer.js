;(function($){"use strict";$.anythingZoomer=function(el,options){var n,o,t,base=this;base.$wrap=$(el);base.wrap=el;base.$wrap.data('zoomer',base);base.init=function(){base.options=o=$.extend({},$.anythingZoomer.defaultOptions,options);n=$.anythingZoomer.classNames;base.state=true;base.enabled=true;base.hovered=false;base.$wrap.addClass(n.wrap).wrapInner('<span class="'+n.wrapInner+'"/>');base.$inner=base.$wrap.find('.'+n.wrapInner);base.$small=base.$wrap.find('.'+o.smallArea);base.$large=base.$wrap.find('.'+o.largeArea);base.update();base.$large.addClass(n.large);base.$small.addClass(n.small);base.$inner.bind('mouseenter'+n.namespace,function(){base.saved=base.enabled;base.hovered=true;if(o.delay){clearTimeout(base.delay);base.enabled=false;base.delay=setTimeout(function(){base.enabled=base.saved;base.position.type='mousemove';base.$inner.trigger(base.position);base.reveal();},o.delay);}else{base.reveal();}}).bind('mouseleave'+n.namespace,function(){base.hovered=false;if(o.delay){clearTimeout(base.delay);base.enabled=base.saved;}
if(base.state&&base.enabled){base.timer=setTimeout(function(){if(base.$zoom.hasClass(n.windowed)){base.hideZoom(true);}},200);}}).bind('mousemove'+n.namespace,function(e){base.position=e;if(!base.hovered){return;}
if(base.state&&base.enabled){clearTimeout(base.timer);var off=base.$small.offset();base.zoomAt(e.pageX-off.left,e.pageY-off.top,null,true);}}).bind(o.switchEvent+(o.switchEvent!==''?n.namespace:''),function(){if(!base.enabled){return;}
if(base.state){base.showLarge();}else{base.showSmall();}});base.showSmall();$.each('initialized zoomed unzoomed'.split(' '),function(i,f){if($.isFunction(o[f])){base.$wrap.bind(f,o[f]);}});base.initialized=true;base.$wrap.trigger('initialized',base);};base.reveal=function(){base.enabled=base.saved;if(base.state&&base.enabled){base.$zoom.stop(true,true).fadeIn(o.speed);if(o.overlay){base.$overlay.addClass(n.overlay);}
base.$smInner.addClass(n.hovered);base.$wrap.trigger('zoom',base);}};base.update=function(){if(base.initialized){base.showSmall();}
base.$smInner=(base.$small.find('.'+n.smallInner).length)?base.$small.find('.'+n.smallInner):base.$small.wrapInner('<span class="'+n.smallInner+'"/>').find('.'+n.smallInner);base.$small.find('.'+n.overly).remove();if(o.clone){t=base.$smInner.clone().removeClass(n.smallInner).addClass(n.largeInner);if(base.$large.length){base.$large.html(t.html());}else{t.wrap('<div class="'+o.largeArea+'">');base.$small.after(t.parent());base.$large=base.$wrap.find('.'+o.largeArea);}}
base.$lgInner=(base.$large.find('.'+n.largeInner).length)?base.$large.find('.'+n.largeInner):base.$large.wrapInner('<span class="'+n.largeInner+'"/>').find('.'+n.largeInner);if(!base.$wrap.find('.'+n.zoom).length){base.$large.wrap('<div class="'+n.zoom+'"/>');base.$zoom=base.$wrap.find('.'+n.zoom);}
if(o.edit&&!base.edit){base.edit=$('<span class="'+n.edit+'"></span>').appendTo(base.$zoom);}
base.$zoom.show();base.largeDim=[base.$lgInner.children().width(),Math.max(base.$lgInner.height(),base.$lgInner.children().height())];base.zoomDim=base.last=[base.$zoom.width(),base.$zoom.height()];base.$zoom.hide();base.smallDim=[base.$smInner.children().width(),base.$small.height()];base.$overlay=$('<div class="'+n.overly+'" style="position:absolute;left:0;top:0;" />').prependTo(base.$small);base.ratio=[base.largeDim[0]/(base.smallDim[0]||1),base.largeDim[1]/(base.smallDim[1]||1)];base.$inner.add(base.$overlay).css({width:base.smallDim[0],height:base.smallDim[1]});};base.showSmall=function(){base.state=true;base.$small.show();base.$zoom.removeClass(n.expanded).addClass(n.windowed+' '+n.zoom).css({width:base.zoomDim[0],height:base.zoomDim[1]});base.$inner.css({width:base.smallDim[0],height:base.smallDim[1]});};base.showLarge=function(){base.state=false;base.$small.hide();base.$zoom.stop(true,true).fadeIn(o.speed).addClass(n.expanded).removeClass(n.windowed+' '+n.zoom).css({height:'auto',width:'auto'});base.$inner.css({width:base.largeDim[0],height:base.largeDim[1]});base.$large.css({left:0,top:0,width:base.largeDim[0],height:base.largeDim[1]});};base.setTarget=function(tar,sec,sz){var t,x=0,y=0;clearTimeout(base.timer);if(!base.$zoom.hasClass(n.windowed)){base.showSmall();}
if(!isNaN(tar)&&!isNaN(sec)){x=parseInt(tar,10);y=parseInt(sec,10);}else if(typeof(tar)==='string'&&$(tar).length){t=$(tar);x=t.position().left+t.width()/2+(sec?sec[0]||0:0);y=t.position().top+t.height()/2+(sec?sec[1]||0:0);}
base.zoomAt(x,y,sz);if(o.overlay){base.$overlay.addClass(n.overlay);}
base.$smInner.addClass(n.hovered);base.$wrap.trigger('zoom',base);};base.zoomAt=function(x,y,sz,internal){var sx=(sz?sz[0]||0:0)||base.last[0],sy=(sz?sz[1]||sz[0]||0:0)||base.last[1],sx2=sx/2,sy2=sy/2,ex=o.edge||(o.edge===0?0:sx2*0.66),ey=o.edge||(o.edge===0?0:sy2*0.66),m=parseInt(base.$inner.css('margin-left'),10)||base.$inner.position().left||0;base.last=[sx,sy];base.current=[x,y];if(o.edit){base.edit.html(Math.round(x)+', '+Math.round(y));}
if((x<-ex)||(x>base.smallDim[0]+ex)||(y<-ey)||(y>base.smallDim[1]+ey)){base.hideZoom(internal);return;}else{base.$zoom.stop(true,true).fadeIn(o.speed);}
base.$zoom.css({left:x-sx2+m,top:y-sy2,width:sx,height:sy});base.$large.css({left:-(x-o.offsetX-sx2/2)*base.ratio[0],top:-(y-o.offsetY-sy2/2)*base.ratio[1]});};base.hideZoom=function(internal){if(internal&&base.$smInner.hasClass(n.hovered)){base.$wrap.trigger('unzoom',base);}
base.last=base.zoomDim;base.$zoom.stop(true,true).fadeOut(o.speed);base.$overlay.removeClass(n.overlay);base.$smInner.removeClass(n.hovered);base.lastKey=null;};base.setEnabled=function(enable){base.enabled=enable;if(enable){var off=base.$small.offset();base.zoomAt(base.position.pageX-off.left,base.position.pageY-off.top,null,true);}else{base.showSmall();base.hideZoom();}};base.init();};$.anythingZoomer.classNames={namespace:'.anythingZoomer',wrap:'az-wrap',wrapInner:'az-wrap-inner',large:'az-large',largeInner:'az-large-inner',small:'az-small',smallInner:'az-small-inner',overlay:'az-overlay',overly:'az-overly',hovered:'az-hovered',zoom:'az-zoom',windowed:'az-windowed',expanded:'az-expanded',edit:'az-coords'};$.anythingZoomer.defaultOptions={smallArea:'small',largeArea:'large',clone:false,overlay:false,speed:100,edge:30,offsetX:0,offsetY:0,switchEvent:'dblclick',delay:0,edit:false};$.fn.anythingZoomer=function(options,second,sx,sy){return this.each(function(){var anyZoom=$(this).data('zoomer');if(/object|undefined/.test(typeof options)){if(anyZoom){anyZoom.update();}else{(new $.anythingZoomer(this,options));}}else if(anyZoom&&(typeof options==='string'||(!isNaN(options)&&!isNaN(second)))){if(/(en|dis)able/.test(options)){anyZoom.setEnabled(options==='enable');}else{anyZoom.setTarget(options,second,sx,sy);}}});};$.fn.getAnythingZoomer=function(){return this.data('zoomer');};})(jQuery);